<?xml version="1.0" encoding="utf-8"?>
<Randomevents>
  <!-- Events defined in <EventPrefabs> can only be triggered via a console command or with a TriggerEventAction -->
  <EventPrefabs>
    <!-- OUTPOST TAKEOVER -->
    <!-- TODO: Change takeover to "liberate outpost" when tagging by team becomes possible and replace the removenpc SE with the following one: -->
    <!--
    <StatusEffectAction targettag="removenpc" >
      <StatusEffect target="this" >
        <SpawnItem identifier="handcuffs" spawnposition="ThisInventory" Equip="true" /> 
      </StatusEffect>
    </StatusEffectAction>
    -->

    <!-- TODO: improve the logic of these later when tag improvements happen -->
    
    <!-- Coalition Attackers-->
    <ScriptedEvent identifier="cooutposttakeoverevent">
      <SetDataAction identifier="takeoverinprogress" value="true" />
      <TriggerEventAction identifier="resettakeoverdata" nextround="true" />
      <TagAction criteria="player" tag="player" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="bot" tag="bot" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="itemidentifier:dockinghatch" tag="eventstart" submarinetype="Outpost" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="hull" tag="eventstart" submarinetype="Outpost" ContinueIfNoTargetsFound="true" />
      <!-- TODO: remove this when AI is fixed and change to team2 in mission itself -->
      <NPCChangeTeamAction npctag="defenders" teamtag="Team2" />
      <TriggerAction target1tag="player" target2tag="eventstart" radius="100" disableincombat="false" disableiftargetincapacitated="false" waitforinteraction="false" allowmultipletargets="true" />
      <!-- tag and remove security: they are terminators and keep responding to attacks after surrender -->
      <TagAction criteria="humanprefabidentifier:securitynpc" tag="removenpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:securitynpcseparatists" tag="removenpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:securitynpccoalition" tag="removenpc" ContinueIfNoTargetsFound="true" />
      <!-- tag and remove outpost manager (mission giver NPC) since they will not move at all and if the player positions themselves inside of them, the player becomes invincible to enemy AI -->
      <TagAction criteria="humanprefabidentifier:outpostmanagerseparatists" tag="removenpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:outpostmanagercoalition" tag="removenpc" ContinueIfNoTargetsFound="true" />
      <!-- tag and remove watchman (unlock path NPC) since the doors to control room will open automatically -->
      <TagAction criteria="humanprefabidentifier:watchman" tag="removenpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:watchmanseparatist" tag="removenpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:soldierseparatists" tag="defenders" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="jobidentifier:cosoldier" tag="attackers" ContinueIfNoTargetsFound="true" />
      <WaitAction time="1" />
      <StatusEffectAction targettag="removenpc">
        <StatusEffect type="Always" target="Character" interval="1" stackable="false">
          <RemoveCharacter />
        </StatusEffect>
      </StatusEffectAction>
      <ReputationAction targettype="Faction" identifier="separatists" increase="-200" />
      <ConversationAction text="eventtext.takeover.attack" dialogtype="Small" targettag="player" eventsprite="coalition" ContinueAutomatically="true" />
      <Label name="checkforcomplete" />
      <CountTargetsAction targettag="separatistssoldier" CompareToTarget="separatistssoldier" MinPercentageRelativeToTarget="75">
        <!-- complete mission if >75% enemies dead  -->
        <Conditional isdead="True"/>
        <Success>
          <MissionStateAction missionidentifier="cotakeover_separatistoutpost" operation="Set" value="1" />
          <ModifyLocationAction faction="Coalition" />
          <SetDataAction identifier="cotakeoveractive" operation="Set" value="0" />
          <NPCChangeTeamAction npctag="defenders" teamtag="FriendlyNPC" />
          <NPCChangeTeamAction npctag="attackers" teamtag="FriendlyNPC" removefromcrew="true" />
          <CombatAction combatmode="Arrest" npctag="attackers" enemytag="defenders" isinstigator="true" guardreaction="none" witnessreaction="none" />
          <ConversationAction text="eventtext.takeover.success" dialogtype="Mission" targettag="player" eventsprite="Coalition" />
          <CheckDataAction identifier="completedtakeoverpreviously" condition="true">
            <Success>
              <ConversationAction text="eventtext.takeover.success.info" dialogtype="Mission" targettag="player" eventsprite="Coalition" />
            </Success>
            <Failure>
              <SpawnAction itemidentifier="metalcrate" spawnlocation="MainSub" targettag="takeoverreward" targetmoduletags="airlock" ignorebyai="true" />
              <StatusEffectAction targettag="takeoverreward">
                <StatusEffect target="This" allowaccess="false" setvalue="true" />
              </StatusEffectAction>
              <ConversationAction text="eventtext.takeover.success.reward" dialogtype="Mission" targettag="player" eventsprite="Infiltration1" />
              <TriggerAction target1tag="player" target2tag="takeoverreward" applytotarget1="interactplayer" radius="500" disableincombat="false" disableiftargetincapacitated="false" waitforinteraction="true" allowmultipletargets="true" />
              <SpawnAction itemidentifier="militaryradio" targetinventory="interactplayer" />
              <StatusEffectAction targettag="takeoverreward">
                <StatusEffect target="This" allowaccess="true" setvalue="true" />
              </StatusEffectAction>
              <ConversationAction text="eventtext.takeover.success.reward.check" dialogtype="Small" targettag="interactplayer" eventsprite="Note2" />
              <SetDataAction identifier="completedtakeoverpreviously" operation="Set" value="true" />
              <ClearTagAction tag="interactplayer" />
            </Failure>
          </CheckDataAction>
        </Success>
        <Failure>
          <Waitaction time="1" />
          <GoTo name="checkforcomplete" />
        </Failure>
      </CountTargetsAction>
    </ScriptedEvent>

    <!-- Separatist Attackers-->
    <ScriptedEvent identifier="sepoutposttakeoverevent">
      <SetDataAction identifier="takeoverinprogress" value="true" />
      <TriggerEventAction identifier="resettakeoverdata" nextround="true" />
      <TagAction criteria="player" tag="player" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="bot" tag="bot" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="itemidentifier:dockinghatch" tag="eventstart" submarinetype="Outpost" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="hull" tag="eventstart" submarinetype="Outpost" ContinueIfNoTargetsFound="true" />
      <!-- TODO: remove this when AI is fixed and change to team2 in mission itself -->
      <NPCChangeTeamAction npctag="defenders" teamtag="Team2" />
      <TriggerAction target1tag="player" target2tag="eventstart" radius="100" disableincombat="false" disableiftargetincapacitated="false" waitforinteraction="false" allowmultipletargets="true" />
      <!-- tag and remove security: they are terminators and keep responding to attacks after surrender -->
      <TagAction criteria="humanprefabidentifier:securitynpc" tag="removenpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:securitynpcseparatists" tag="removenpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:securitynpccoalition" tag="removenpc" ContinueIfNoTargetsFound="true" />
      <!-- tag and remove outpost manager (mission giver NPC) since they will not move at all and if the player positions themselves inside of them, the player becomes invincible to enemy AI -->
      <TagAction criteria="humanprefabidentifier:outpostmanagerseparatists" tag="removenpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:outpostmanagercoalition" tag="removenpc" ContinueIfNoTargetsFound="true" />
      <!-- tag and remove watchman (unlock path NPC) since the doors to control room will open automatically -->
      <TagAction criteria="humanprefabidentifier:watchman" tag="removenpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:watchmanseparatist" tag="removenpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:soldiercoalition" tag="defenders" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="jobidentifier:sepsoldier" tag="attackers" ContinueIfNoTargetsFound="true" />
      <WaitAction time="1" />
      <StatusEffectAction targettag="removenpc">
        <StatusEffect type="Always" target="Character" interval="1" stackable="false">
          <RemoveCharacter />
        </StatusEffect>
      </StatusEffectAction>
      <ReputationAction targettype="Faction" identifier="coalition" increase="-200" />
      <ConversationAction text="eventtext.takeover.attack" dialogtype="Small" targettag="player" eventsprite="separatists" ContinueAutomatically="true" />
      <Label name="checkforcomplete" />
      <CountTargetsAction targettag="coalitionsoldier" CompareToTarget="coalitionsoldier" MinPercentageRelativeToTarget="75">
        <!-- complete mission if >75% enemies dead  -->
        <Conditional isdead="True"/>
        <Success>
          <MissionStateAction missionidentifier="septakeover_coalitionoutpost" operation="Set" value="1" />
          <ModifyLocationAction faction="Separatists" />
          <SetDataAction identifier="septakeoveractive" operation="Set" value="0" />
          <NPCChangeTeamAction npctag="defenders" teamtag="FriendlyNPC" />
          <NPCChangeTeamAction npctag="attackers" teamtag="FriendlyNPC" removefromcrew="true" />
          <CombatAction combatmode="Arrest" npctag="attackers" enemytag="defenders" isinstigator="true" guardreaction="none" witnessreaction="none" />
          <ConversationAction text="eventtext.takeover.success" dialogtype="Mission" targettag="player" eventsprite="Separatists" />
          <CheckDataAction identifier="completedtakeoverpreviously" condition="true">
            <Success>
              <ConversationAction text="eventtext.takeover.success.info" dialogtype="Mission" targettag="player" eventsprite="Separatists" />
            </Success>
            <Failure>
              <SpawnAction itemidentifier="metalcrate" spawnlocation="MainSub" targettag="takeoverreward" targetmoduletags="airlock" ignorebyai="true" />
              <StatusEffectAction targettag="takeoverreward">
                <StatusEffect target="This" allowaccess="false" setvalue="true" />
              </StatusEffectAction>
              <ConversationAction text="eventtext.takeover.success.reward" dialogtype="Mission" targettag="player" eventsprite="Stuckinthemiddle1" />
              <TriggerAction target1tag="player" target2tag="takeoverreward" applytotarget1="interactplayer" radius="500" disableincombat="false" disableiftargetincapacitated="false" waitforinteraction="true" allowmultipletargets="true" />
              <SpawnAction itemidentifier="militaryradio" targetinventory="interactplayer" />
              <StatusEffectAction targettag="takeoverreward">
                <StatusEffect target="This" allowaccess="true" setvalue="true" />
              </StatusEffectAction>
              <ConversationAction text="eventtext.takeover.success.reward.check" dialogtype="Small" targettag="interactplayer" eventsprite="Note2" />
              <SetDataAction identifier="completedtakeoverpreviously" operation="Set" value="true" />
              <ClearTagAction tag="interactplayer" />
            </Failure>
          </CheckDataAction>
        </Success>
        <Failure>
          <Waitaction time="1" />
          <GoTo name="checkforcomplete" />
        </Failure>
      </CountTargetsAction>
    </ScriptedEvent>

    <!-- Remove Temporary Crewmembers -->
    <ScriptedEvent identifier="removetempcrew">
      <TagAction criteria="jobidentifier:cosoldier" tag="tempcrew" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="jobidentifier:sepsoldier" tag="tempcrew" ContinueIfNoTargetsFound="true" />
      <NPCChangeTeamAction npctag="tempcrew" teamtag="FriendlyNPC" removefromcrew="true" />
    </ScriptedEvent>

    <!-- ////////// MANUALLY TRIGGERED TAKEOVERS \\\\\\\\\\ -->
    <ScriptedEvent identifier="startmanualtakeover">
      <TagAction criteria="player" tag="player" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:outpostmanagercoalition" tag="coalitionstation" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:outpostmanagerseparatists" tag="separatiststation" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:outpostmanagerpirate" tag="banditstation" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:outpostmanagerhusk" tag="churchstation" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="itemtag:reactor" tag="targetreactor" submarinetype="Outpost" ContinueIfNoTargetsFound="true" />
      <!-- check if a takeover is active | succeed and allow starting a takeover if no takeover is currently active at this location -->
      <CheckDataAction identifier="takeoverinprogress" condition="false">
        <Success>
          <!-- Set the takeoverinprogress data to true to prevent being able to call this event again by another player while it's currently active -->
          <SetDataAction identifier="takeoverinprogress" value="true" />
          <!-- Checking if the target is dead allows the action to fail if the target is present and automatically succeeds if no target was found, checking for the next target -->
          <CheckConditionalAction targettag="coalitionstation">
            <Conditional isDead="true" />
            <Success>
              <CheckConditionalAction targettag="separatiststation">
                <Conditional isDead="true" />
                <Success>
                  <CheckConditionalAction targettag="banditstation">
                    <Conditional isDead="true" />
                    <Success>
                      <CheckConditionalAction targettag="churchstation">
                        <Conditional isDead="true" />
                        <Success>
                          <ConversationAction text="eventtext.manualtakeover.call.nostation" dialogtype="Small" targettag="statuseffecttarget" eventsprite="BombScare1" ContinueAutomatically="true" />
                          <SetDataAction identifier="takeoverinprogress" value="false" />
                        </Success>
                        <Failure>
                          <ConversationAction text="eventtext.manualtakeover.call.church" dialogtype="Small" targettag="statuseffecttarget" eventsprite="BombScare1" ContinueAutomatically="true" />
                          <SetDataAction identifier="takeoverinprogress" value="false" />
                        </Failure>
                      </CheckConditionalAction>
                    </Success>
                    <Failure>
                      <ConversationAction text="eventtext.manualtakeover.call.bandits" dialogtype="Small" targettag="statuseffecttarget" eventsprite="BombScare1" ContinueAutomatically="true" />
                      <SetDataAction identifier="takeoverinprogress" value="false" />
                    </Failure>
                  </CheckConditionalAction>
                </Success>
                <Failure>
                  <ConversationAction text="eventtext.manualtakeover.call.coalition" dialogtype="Small" targettag="statuseffecttarget" eventsprite="coalition">
                    <Option text="eventtext.manualtakeover.call.playerresponse">
                      <ConversationAction text="eventtext.manualtakeover.call.permissiongranted" ContinueAutomatically="true" />
                      <TriggerEventAction identifier="manualcooutposttakeoverevent" />
                    </Option>
                    <Option text="eventtext.option.nevermind" endconversation="true">
                      <SetDataAction identifier="takeoverinprogress" value="false" />
                    </Option>
                  </ConversationAction>
                </Failure>
              </CheckConditionalAction>
            </Success>
            <Failure>
              <ConversationAction text="eventtext.manualtakeover.call.separatists" dialogtype="Small" targettag="statuseffecttarget" eventsprite="separatists">
                <Option text="eventtext.manualtakeover.call.playerresponse">
                  <ConversationAction text="eventtext.manualtakeover.call.permissiongranted" ContinueAutomatically="true" />
                  <TriggerEventAction identifier="manualsepoutposttakeoverevent" />
                </Option>
                <Option text="eventtext.option.nevermind" endconversation="true">
                  <SetDataAction identifier="takeoverinprogress" value="false" />
                </Option>
              </ConversationAction>
            </Failure>
          </CheckConditionalAction>
        </Success>
        <Failure>
          <!-- If the value for takeoverinprogress is true, check for an outpost reactor. If none is found and thus meaning this is not a station level, reset the takeoverinprogress data to false -->
          <!-- This just acts as a way to reset the takeoverinprogress value, should it not get reset after completing a takeover due to the game bugging out -->
          <CheckConditionalAction targettag="targetreactor" CompareToTarget="targetreactor" MinPercentageRelativeToTarget="1">
            <Conditional HasTag="neq reactor" />
            <Success>
              <ConversationAction text="eventtext.manualtakeover.call.nostation" dialogtype="Small" targettag="statuseffecttarget" eventsprite="BombScare1" ContinueAutomatically="true" />
              <SetDataAction identifier="takeoverinprogress" value="false" />
            </Success>
            <Failure>
              <!-- end the event -->
            </Failure>
          </CheckConditionalAction>
        </Failure>
      </CheckDataAction>
    </ScriptedEvent>

    <!-- Reset the takeoverinprogress data to false to allow triggering a manual takeover or destroying an outpost again -->
    <ScriptedEvent identifier="resettakeoverdata">
      <SetDataAction identifier="takeoverinprogress" value="false" />
    </ScriptedEvent>

    <!-- Coalition Attackers-->
    <ScriptedEvent identifier="manualcooutposttakeoverevent">
      <SetDataAction identifier="takeoverinprogress" value="true" />
      <TriggerEventAction identifier="resettakeoverdata" nextround="true" />
      <TagAction criteria="player" tag="player" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="bot" tag="bot" ContinueIfNoTargetsFound="true" />
      <!-- VANILLA NPCs -->
      <TagAction criteria="humanprefabidentifier:outpostmanagercoalition" tag="sepnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:outpostmanagerseparatists" tag="sepnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:hrmanager" tag="sepnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:reactoroperator" tag="sepnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:subupgradenpc" tag="sepnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:subsalesnpc" tag="sepnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:merchantoutpost" tag="sepnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:merchantcity" tag="sepnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:merchantmine" tag="sepnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:merchantresearch" tag="sepnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:merchantmilitary" tag="sepnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:merchantarmory" tag="sepnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:merchantmedical" tag="sepnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:merchantengineering" tag="sepnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:securitynpccoalition" tag="sepnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:securitynpcseparatists" tag="sepnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:armsdealer" tag="sepnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:cargomissiongiver" tag="sepnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:salvagemissiongiver" tag="sepnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:outpostdoctor" tag="sepnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:watchman" tag="sepnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:watchmanseparatist" tag="sepnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:commoner" tag="sepnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:researcher" tag="sepnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:miner" tag="sepnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:clown" tag="sepnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:merchantclown" tag="sepnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:huskcultist" tag="sepnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:huskcultecclesiast" tag="sepnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:merchanthusk" tag="sepnpc" ContinueIfNoTargetsFound="true" />
      <!-- DE specific NPCs -->
      <TagAction criteria="humanprefabidentifier:sergeantcoalition" tag="sepnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:sergeantseparatists" tag="sepnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:de_outpostdoctor" tag="sepnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:quartermaster" tag="sepnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:bartender" tag="sepnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:merchantsellonly" tag="sepnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="jobidentifier:cosoldier" tag="attackers" ContinueIfNoTargetsFound="true" />
      <ReputationAction targettype="Faction" identifier="separatists" increase="-200" />
      <NPCChangeTeamAction npctag="sepnpc" teamtag="Team2" />
      <Label name="checkforcomplete" />
      <CountTargetsAction targettag="sepnpc" CompareToTarget="sepnpc" MinPercentageRelativeToTarget="75">
        <!-- complete mission if >75% enemies dead  -->
        <Conditional isdead="True"/>
        <Success>
          <ModifyLocationAction faction="Coalition" />
          <!-- Disabled to not allow getting a new official takeover mission when completing a manually triggered one -->
          <!-- <SetDataAction identifier="cotakeoveractive" operation="Set" value="0" /> -->
          <NPCChangeTeamAction npctag="sepnpc" teamtag="FriendlyNPC" />
          <!-- Disabled to allow keeping the crew for the outpost they're actually supposed to take over -->
          <!-- <NPCChangeTeamAction npctag="attackers" teamtag="FriendlyNPC" removefromcrew="true" /> -->
          <CombatAction combatmode="Arrest" npctag="attackers" enemytag="sepnpc" isinstigator="true" guardreaction="none" witnessreaction="none" />
          <ConversationAction text="eventtext.takeover.success" dialogtype="Mission" targettag="player" eventsprite="Coalition" />
          <CheckReputationAction targettype="faction" identifier="coalition" condition="lt -70">
            <Success>
              <ReputationAction targettype="Faction" identifier="coalition" increase="25" />
            </Success>
            <Failure>
              <ReputationAction targettype="Faction" identifier="coalition" increase="7" />
            </Failure>
          </CheckReputationAction>
        </Success>
        <Failure>
          <Waitaction time="1" />
          <GoTo name="checkforcomplete" />
        </Failure>
      </CountTargetsAction>
    </ScriptedEvent>

    <!-- Separatist Attackers-->
    <ScriptedEvent identifier="manualsepoutposttakeoverevent">
      <SetDataAction identifier="takeoverinprogress" value="true" />
      <TriggerEventAction identifier="resettakeoverdata" nextround="true" />
      <TagAction criteria="player" tag="player" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="bot" tag="bot" ContinueIfNoTargetsFound="true" />
      <!-- VANILLA NPCs -->
      <TagAction criteria="humanprefabidentifier:outpostmanagercoalition" tag="conpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:outpostmanagerseparatists" tag="conpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:hrmanager" tag="conpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:reactoroperator" tag="conpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:subupgradenpc" tag="conpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:subsalesnpc" tag="conpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:merchantoutpost" tag="conpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:merchantcity" tag="conpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:merchantmine" tag="conpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:merchantresearch" tag="conpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:merchantmilitary" tag="conpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:merchantarmory" tag="conpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:merchantmedical" tag="conpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:merchantengineering" tag="conpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:securitynpccoalition" tag="conpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:securitynpcseparatists" tag="conpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:armsdealer" tag="conpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:cargomissiongiver" tag="conpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:salvagemissiongiver" tag="conpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:outpostdoctor" tag="conpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:watchman" tag="conpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:watchmanseparatist" tag="conpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:commoner" tag="conpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:researcher" tag="conpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:miner" tag="conpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:clown" tag="conpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:merchantclown" tag="conpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:huskcultist" tag="conpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:huskcultecclesiast" tag="conpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:merchanthusk" tag="conpc" ContinueIfNoTargetsFound="true" />
      <!-- DE specific NPCs -->
      <TagAction criteria="humanprefabidentifier:sergeantcoalition" tag="conpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:sergeantseparatists" tag="conpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:de_outpostdoctor" tag="conpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:quartermaster" tag="conpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:bartender" tag="conpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:merchantsellonly" tag="conpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="jobidentifier:sepsoldier" tag="attackers" ContinueIfNoTargetsFound="true" />
      <ReputationAction targettype="Faction" identifier="coalition" increase="-200" />
      <NPCChangeTeamAction npctag="conpc" teamtag="Team2" />
      <Label name="checkforcomplete" />
      <CountTargetsAction targettag="conpc" CompareToTarget="conpc" MinPercentageRelativeToTarget="75">
        <!-- complete mission if >75% enemies dead  -->
        <Conditional isdead="True"/>
        <Success>
          <ModifyLocationAction faction="Separatists" />
          <!-- Disabled to not allow getting a new official takeover mission when completing a manually triggered one -->
          <!-- <SetDataAction identifier="septakeoveractive" operation="Set" value="0" /> -->
          <NPCChangeTeamAction npctag="conpc" teamtag="FriendlyNPC" />
          <!-- Disabled to allow keeping the crew for the outpost they're actually supposed to take over -->
          <!-- <NPCChangeTeamAction npctag="attackers" teamtag="FriendlyNPC" removefromcrew="true" /> -->
          <CombatAction combatmode="Arrest" npctag="attackers" enemytag="conpc" isinstigator="true" guardreaction="none" witnessreaction="none" />
          <ConversationAction text="eventtext.takeover.success" dialogtype="Mission" targettag="player" eventsprite="Separatists" />
          <CheckReputationAction targettype="faction" identifier="separatists" condition="lte -70">
            <Success>
              <ReputationAction targettype="Faction" identifier="separatists" increase="25" />
            </Success>
            <Failure>
              <ReputationAction targettype="Faction" identifier="separatists" increase="7" />
            </Failure>
          </CheckReputationAction>
        </Success>
        <Failure>
          <Waitaction time="1" />
          <GoTo name="checkforcomplete" />
        </Failure>
      </CountTargetsAction>
    </ScriptedEvent>

    <!-- ////////// OUTPOST DESTRUCTION \\\\\\\\\\ -->
    <!-- Turns a station into an abandoned station -->
    <ScriptedEvent identifier="outpostdestruction">
      <TagAction criteria="player" tag="player" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="bot" tag="bot" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="itemidentifier:dockinghatch" tag="eventstart" submarinetype="Outpost" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="itemtag:reactor" tag="targetreactor" submarinetype="Outpost" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="hull" tag="eventstart" submarinetype="Outpost" ContinueIfNoTargetsFound="true" />
      <TriggerAction target1tag="player" target2tag="eventstart" radius="100" disableincombat="false" disableiftargetincapacitated="false" waitforinteraction="false" allowmultipletargets="true" />
      <!-- VANILLA NPCs -->
      <TagAction criteria="humanprefabidentifier:outpostmanagercoalition" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:outpostmanagerseparatists" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:hrmanager" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:reactoroperator" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:subupgradenpc" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:subsalesnpc" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:merchantoutpost" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:merchantcity" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:merchantmine" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:merchantresearch" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:merchantmilitary" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:merchantarmory" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:merchantmedical" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:merchantengineering" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:securitynpccoalition" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:securitynpcseparatists" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:armsdealer" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:cargomissiongiver" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:salvagemissiongiver" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:outpostdoctor" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:watchman" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:watchmanseparatist" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:commoner" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:researcher" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:miner" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:clown" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:merchantclown" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:huskcultist" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:huskcultecclesiast" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:merchanthusk" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <!-- DE specific NPCs -->
      <TagAction criteria="humanprefabidentifier:sergeantcoalition" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:sergeantseparatists" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:de_outpostdoctor" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:quartermaster" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:bartender" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:merchantsellonly" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:outpostmanagerpirate" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:hrmanagerpirate" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:repairnpcpirate" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:reactoroperatorpirate" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:subupgradenpcpirate" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:subsalesnpcpirate" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:securitynpcpirate" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:outpostdoctorpirate" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:gateinformant" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:commonerpirate" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:outpostmanagerhusk" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:huskcultistsecurity" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:merchanthuskengineering" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:outposthuskdoctor" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:hireablehuskscientist" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:hireablehusktemplar" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <!-- <TagAction criteria="humanprefabidentifier:___" tag="targetnpc" ContinueIfNoTargetsFound="true" /> -->
      <WaitAction time="1" />
      <Label name="checkforcomplete" />
      <CountTargetsAction targettag="targetreactor" CompareToTarget="targetreactor" MinPercentageRelativeToTarget="1">
        <!-- succeed if at least 1 reactor is destroyed -->
        <Conditional condition="eq 0"/>
        <Success>
          <CountTargetsAction targettag="targetnpc" CompareToTarget="targetnpc" MinPercentageRelativeToTarget="90">
            <!-- succeed if >90% enemies dead  -->
            <Conditional isdead="True"/>
            <Success>
              <!-- check if a takeover is active | succeed and allow destruction of the station if no takeover is active at this location -->
              <CheckDataAction identifier="takeoverinprogress" condition="false">
                <Success>
                  <ReputationAction targettype="Location" increase="-75" />
                  <ModifyLocationAction type="destroyedstation" />
                  <ConversationAction text="eventtext.outpostdestruction.npcsflee" dialogtype="Mission" targettag="player" eventsprite="ventinside" />
                  <!-- <CheckReputationAction targettype="faction" identifier="bandits" condition="lte -13">
                    <Success>
                      <ReputationAction targettype="Faction" identifier="bandits" increase="10" />
                    </Success>
                    <Failure>
                      <ReputationAction targettype="Faction" identifier="bandits" increase="3" />
                    </Failure>
                  </CheckReputationAction> -->
                </Success>
                <Failure>
                  <GoTo name="endevent" />
                </Failure>
              </CheckDataAction>
            </Success>
            <Failure>
              <Waitaction time="1" />
              <GoTo name="checkforcomplete" />
            </Failure>
          </CountTargetsAction>
        </Success>
        <Failure>
          <Waitaction time="1" />
          <GoTo name="checkforcomplete" />
        </Failure>
      </CountTargetsAction>
      <Label name="endevent" />
    </ScriptedEvent>
    <!-- Turns a station into an empty location -->
    <ScriptedEvent identifier="outpostdestructionnostation">
      <TagAction criteria="player" tag="player" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="bot" tag="bot" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="itemidentifier:dockinghatch" tag="eventstart" submarinetype="Outpost" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="itemtag:reactor" tag="targetreactor" submarinetype="Outpost" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="hull" tag="targethull" submarinetype="Outpost" ContinueIfNoTargetsFound="true" />
      <TriggerAction target1tag="player" target2tag="eventstart" radius="100" disableincombat="false" disableiftargetincapacitated="false" waitforinteraction="false" allowmultipletargets="true" />
      <!-- VANILLA NPCs -->
      <TagAction criteria="humanprefabidentifier:outpostmanagercoalition" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:outpostmanagerseparatists" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:hrmanager" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:reactoroperator" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:subupgradenpc" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:subsalesnpc" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:merchantoutpost" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:merchantcity" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:merchantmine" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:merchantresearch" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:merchantmilitary" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:merchantarmory" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:merchantmedical" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:merchantengineering" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:securitynpccoalition" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:securitynpcseparatists" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:armsdealer" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:cargomissiongiver" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:salvagemissiongiver" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:outpostdoctor" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:watchman" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:watchmanseparatist" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:commoner" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:researcher" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:miner" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:clown" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:merchantclown" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:huskcultist" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:huskcultecclesiast" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:merchanthusk" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <!-- DE specific NPCs -->
      <TagAction criteria="humanprefabidentifier:sergeantcoalition" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:sergeantseparatists" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:de_outpostdoctor" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:quartermaster" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:bartender" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:merchantsellonly" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:outpostmanagerpirate" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:hrmanagerpirate" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:repairnpcpirate" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:reactoroperatorpirate" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:subupgradenpcpirate" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:subsalesnpcpirate" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:securitynpcpirate" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:outpostdoctorpirate" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:gateinformant" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:commonerpirate" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:outpostmanagerhusk" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:huskcultistsecurity" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:merchanthuskengineering" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:outposthuskdoctor" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:hireablehuskscientist" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <TagAction criteria="humanprefabidentifier:hireablehusktemplar" tag="targetnpc" ContinueIfNoTargetsFound="true" />
      <!-- <TagAction criteria="humanprefabidentifier:___" tag="targetnpc" ContinueIfNoTargetsFound="true" /> -->
      <WaitAction time="1" />
      <Label name="checkforcomplete" />
      <CountTargetsAction targettag="targethull" CompareToTarget="targethull" MinPercentageRelativeToTarget="50">
        <!-- succeed if at 50% of the hulls are at least 50% flooded -->
        <Conditional waterpercentage="gte 50"/>
        <Success>
          <CountTargetsAction targettag="targetnpc" CompareToTarget="targetnpc" MinPercentageRelativeToTarget="90">
            <!-- succeed if >90% enemies dead  -->
            <Conditional isdead="True"/>
            <Success>
              <!-- check if a takeover is active | succeed and allow destruction of the station if no takeover is active at this location -->
              <CheckDataAction identifier="takeoverinprogress" condition="false">
                <Success>
                  <ModifyLocationAction type="none" />
                  <ConversationAction text="eventtext.outpostdestruction.placeruined" dialogtype="Mission" targettag="player" eventsprite="ventinside" />
                  <!-- <CheckReputationAction targettype="faction" identifier="bandits" condition="lte -13">
                    <Success>
                      <ReputationAction targettype="Faction" identifier="bandits" increase="10" />
                    </Success>
                    <Failure>
                      <ReputationAction targettype="Faction" identifier="bandits" increase="3" />
                    </Failure>
                  </CheckReputationAction> -->
                </Success>
                <Failure>
                  <GoTo name="endevent" />
                </Failure>
              </CheckDataAction>
            </Success>
            <Failure>
              <Waitaction time="1" />
              <GoTo name="checkforcomplete" />
            </Failure>
          </CountTargetsAction>
        </Success>
        <Failure>
          <Waitaction time="1" />
          <GoTo name="checkforcomplete" />
        </Failure>
      </CountTargetsAction>
      <Label name="endevent" />
    </ScriptedEvent>
        
  </EventPrefabs>
</Randomevents>
